import{j as e,K as Ne,r as h,b as P}from"./app-B8YGctXO.js";import{D as we,e as ye,a as ke,c as ve}from"./dialog-Dp6YjYFa.js";import{I as v}from"./input-DYZ0kQ36.js";import{L as S}from"./label-BhH6eUgD.js";import{T as Se}from"./use-mobile-navigation-B5qfKN1I.js";import{S as Te}from"./algorithm-model-DxXWS6d6.js";import{F as Ce}from"./form-loop-kriteria-CKoZPAgO.js";import{I as T}from"./input-error-CsxlQD2v.js";import{T as Ie,a as Le,b as C,c as I,d as _e,e as L}from"./table-CcVoc2ry.js";import{P as G}from"./person-standing-s5_Sf9C7.js";import{B as D}from"./button-BM1BWDmo.js";import{c as Q}from"./proxy-C5QYoeYH.js";import{U as E}from"./user-DpYRAI1e.js";import{M as U}from"./map-pin-BX31As-g.js";import{C as R}from"./calendar-D1OdveQ7.js";import{L as V}from"./loader-circle-B8zACiUB.js";import{A as Be}from"./activity-Bc9cMAy9.js";import{S as Fe}from"./scale-vSTMbz4m.js";import{C as Z}from"./circle-check-big-DKqSH2-V.js";import{C as Me}from"./circle-alert-Bvw_RjkP.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ze=[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]],Pe=Q("Heart",ze);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const De=[["path",{d:"M2 22c1.25-.987 2.27-1.975 3.9-2.2a5.56 5.56 0 0 1 3.8 1.5 4 4 0 0 0 6.187-2.353 3.5 3.5 0 0 0 3.69-5.116A3.5 3.5 0 0 0 20.95 8 3.5 3.5 0 1 0 16 3.05a3.5 3.5 0 0 0-5.831 1.373 3.5 3.5 0 0 0-5.116 3.69 4 4 0 0 0-2.348 6.155C3.499 15.42 4.409 16.712 4.2 18.1 3.926 19.743 3.014 20.732 2 22",key:"1134nt"}],["path",{d:"M2 22 17 7",key:"1q7jp2"}]],J=Q("LeafyGreen",De);function Ee({data:i}){return e.jsxs(Ie,{className:"w-full",children:[e.jsxs(Le,{children:[e.jsx(C,{children:e.jsx(I,{colSpan:7,children:e.jsxs("h3",{className:"mb-3 flex items-center justify-center gap-2 text-center text-sm font-semibold text-white",children:[e.jsx(G,{className:"h-4 w-4"}),"Klasifikasi Berdasarkan Status Gizi"]})})}),e.jsxs(C,{children:[e.jsx(I,{className:"w-10",children:"No."}),e.jsx(I,{className:"cursor-pointer",children:"Nama Label"}),e.jsx(I,{className:"cursor-pointer",children:"Penanganan"})]})]}),e.jsx(_e,{children:(i==null?void 0:i.length)>0?i.map((m,x)=>e.jsxs(C,{children:[e.jsx(L,{children:x+1}),e.jsx(L,{children:m.label.nama}),e.jsx(L,{children:m.tekstur})]},x)):e.jsx(C,{children:e.jsx(L,{colSpan:6,className:"text-center text-sm text-gray-500",children:"Tidak ada data"})})})]})}const rs=({data:i,setData:m,processing:x,errors:j,kriteria:f,setResult:W,setFeature:A,submit:X})=>{const{auth:Ge}=Ne().props,[_,N]=h.useState(!1),[g,ee]=h.useState(null),[B]=h.useState(new Te),[se,H]=h.useState(!1),[n,ae]=h.useState(null),[te,le]=h.useState(!1),F=new Date,[M,re]=h.useState(i.nik||""),[w,p]=h.useState({title:"",show:!1,message:"",type:"success"}),ie=h.useCallback(t=>{const{value:s}=t.target,a=f.findIndex(l=>l.nama.toLowerCase().includes("umur")),o=pe(s);m(l=>{var r;return{...l,tanggal_lahir:s,kriteria:(r=l.kriteria)==null?void 0:r.map((c,d)=>d===a?{...c,nilai:o.toString()}:c)}})},[i,m]),ne=h.useCallback(t=>{const{name:s,value:a}=t.target,[o,l]=s.split("."),r=Number(l);o==="kriteria"?(a===""||/^-?\d*\.?\d*$/.test(a))&&m(c=>{var $,O,K;const d=($=c.kriteria)==null?void 0:$.map((u,k)=>k===r?{...u,nilai:a}:u),b=f.findIndex(u=>u.nama.includes("BB")),z=f.findIndex(u=>u.nama.includes("TB")),Y=f.findIndex(u=>u.nama.toLowerCase().includes("imt"));if((r===b||r===z)&&Y!==-1){const u=Number(r===b?a:((O=d==null?void 0:d[b])==null?void 0:O.nilai)??0),k=Number(r===z?a:((K=d==null?void 0:d[z])==null?void 0:K.nilai)??0);if(u>0&&k>0)return{...c,kriteria:d==null?void 0:d.map((q,je)=>je===Y?{...q,nilai:be(u,k)}:q)}}return{...c,kriteria:d}}):m(c=>({...c,[s]:a}))},[f,m]),oe=(t,s)=>{t&&s!==void 0&&i&&i.kriteria?m(t==="label"?a=>({...a,[t]:s}):a=>{var o;return{...a,kriteria:(o=a.kriteria)==null?void 0:o.map((l,r)=>r===Number(t)?{...l,nilai:s}:l)}}):console.error("Invalid data: name, value, or kriteria may be undefined")},ce=async t=>{try{const s=await P.get(route("api.get.label-sayuran-by-label",{label:t}));if(s.status!==200)throw new Error("Failed to fetch rekomendasi makanan");const a=await s.data;console.log(a),m(o=>({...o,statusGizi:a}))}catch(s){return console.error(s),p({title:"Error",show:!0,message:s.message,type:"error"}),null}};h.useEffect(()=>{(async()=>{N(!0);try{const s=await B.fetchAndProcessData();await B.loadModel(),console.log(s),ee(s)}catch(s){p({title:"Error",show:!0,message:`${s.message}, Lakukan training pada halaman decision Tree sebelum masuk Pemeriksaan Gizi Ibu Hamil`,type:"error"}),le(!0)}finally{N(!1)}})()},[]);const me=t=>{const s=P.get(route("api.get.pasien-by-nik",{nik:t}));s&&s.then(a=>{const o=a.data;m(l=>({...l,nama:o.nama,tempat_lahir:o.tempat_lahir,tanggal_lahir:o.tanggal_lahir,jenis_kelamin:o.jenis_kelamin,alamat:o.alamat}))}).catch(a=>{console.log(a)})},de=async t=>{var s;t.preventDefault(),N(!0);try{const a=(s=i.kriteria)==null?void 0:s.map(o=>{const l=o.nilai;(l==null||l==="")&&p({title:"Error",show:!0,message:"Nilai jenis kelamin, usia,  BB, TB, IMT Tidak Boleh Kosong ",type:"error"});const r=String(l).toLowerCase();return r==="laki-laki"?0:r==="perempuan"?1:r==="kurang"?0:r==="sedang"?1:r==="baik"?2:!isNaN(parseFloat(l))&&isFinite(l)?parseFloat(l):l});if(i.nik===""||i.nama===""||i.tempat_lahir==="")console.log(i.nik,i.nama),p({title:"Error",show:!0,message:"NIK, Nama, Orang Tua, Tempat Lahir Tidak Boleh Kosong ",type:"error"});else{const o={trainingData:g==null?void 0:g.features,className:g==null?void 0:g.labelsY,inputFeature:a},l=await P.post("https://delapain.my.id/api/svm/",o),r=g==null?void 0:g.label.find((d,b)=>d.id===l.data.result),c=r==null?void 0:r.nama;if(l.data.status!=="success")p({title:"Hasil Prediksi",show:!0,message:l.data.status,type:"error"});else if(ae({prediction:l.data.result,label:c??null,rekomendasi:(r==null?void 0:r.deskripsi)??null,error:null}),A&&A(i.kriteria),c!=null){const d=c.toString();m(b=>({...b,label:d})),W({prediction:l.data.result,label:c??null,rekomendasi:(r==null?void 0:r.deskripsi)??null,error:null}),ce((c==null?void 0:c.toString())??""),he()}}}catch(a){console.error(a),p({title:"Hasil Prediksi",show:!0,message:a,type:"success"})}finally{N(!1)}},he=()=>{H(!0)},y=new Date(F);y.setFullYear(F.getFullYear()-12);const xe=y.toISOString().split("T")[0];y.setFullYear(F.getFullYear()-51);const ue=y.toISOString().split("T")[0];function ge(t){const s=new Date(t),a=new Date;let o=a.getFullYear()-s.getFullYear(),l=a.getMonth()-s.getMonth(),r=a.getDate()-s.getDate();return r<0&&(l--,r+=new Date(a.getFullYear(),a.getMonth(),0).getDate()),l<0&&(o--,l+=12),`${o} tahun, ${l} bulan, ${r} hari`}function pe(t){const s=new Date(t),a=new Date;let o=a.getFullYear()-s.getFullYear(),l=a.getMonth()-s.getMonth(),r=a.getDate()-s.getDate(),c=o*12+l;return r<0&&(c-=1),c.toString()}const fe=h.useMemo(()=>{if(!n)return"";switch(n.label){case"beresiko":return"bg-red-100 border-red-300 text-red-800";case"gizi buruk":return"bg-yellow-100 border-yellow-300 text-yellow-800";case"gizi normal":return"bg-green-100 border-green-300 text-green-800";default:return"bg-blue-100 border-blue-300 text-blue-800"}},[n]),be=(t,s)=>{const a=s/100;return(t/(a*a)).toFixed(3)};return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-blue-50 px-4 py-8",children:e.jsxs("div",{className:"mx-auto max-w-4xl",children:[e.jsx(Se,{open:w.show,onOpenChange:()=>p(t=>({...t,show:!1})),title:w.title,description:w.message,duration:1e4,variant:w.type}),e.jsxs("div",{className:"mb-8 text-center",children:[e.jsxs("div",{className:"inline-flex items-center gap-3 rounded-full bg-white px-4 py-2 shadow-sm",children:[e.jsx("div",{className:"flex h-10 w-10 items-center justify-center rounded-full bg-green-100",children:e.jsx(J,{className:"h-5 w-5 text-green-600"})}),e.jsx("h1",{className:"text-xl font-bold text-slate-800",children:"Deteksi Status Gizi Ibu Hamil"})]}),e.jsx("p",{className:"mt-3 text-slate-600",children:"Sistem prediksi status gizi menggunakan metode SVM"})]}),e.jsxs("div",{className:"overflow-hidden rounded-2xl border border-slate-200 bg-white shadow-lg",children:[e.jsxs("div",{className:"bg-gradient-to-r from-green-500 to-emerald-600 p-4 text-white",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Data Pasien"}),e.jsx("p",{className:"text-sm opacity-90",children:"Lengkapi informasi di bawah untuk analisis gizi"})]}),e.jsx("div",{className:"p-6 md:p-8",children:e.jsxs("form",{onSubmit:t=>de(t),className:"space-y-6",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(S,{htmlFor:"nik",className:"flex items-center gap-2",children:[e.jsx(E,{className:"h-4 w-4 text-slate-500"}),"NIK Pasien"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(v,{id:"nik",type:"text",required:!0,tabIndex:1,autoComplete:"nik",value:M,onChange:t=>{const s=t.target.value;/^\d*$/.test(s)&&s.length<=16&&(m(a=>({...a,nik:s})),re(s))},disabled:x,placeholder:"Masukkan NIK Pasien",className:"pl-10"}),e.jsx("div",{className:"absolute inset-y-0 left-0 flex items-center pl-3",children:e.jsx(E,{className:"h-4 w-4 text-slate-400"})})]}),e.jsx(D,{type:"button",variant:"outline",onClick:()=>{M.length<=16?me(Number(M)):p({title:"Error",show:!0,message:"NIK harus 16 digit",type:"error"})},children:"Cari"})]}),e.jsx(T,{message:j.nik,className:"mt-2"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(S,{htmlFor:"nama",className:"flex items-center gap-2",children:[e.jsx(G,{className:"h-4 w-4 text-slate-500"}),"Nama Pasien"]}),e.jsxs("div",{className:"relative",children:[e.jsx(v,{id:"nama",type:"text",required:!0,tabIndex:1,autoComplete:"nama",value:i.nama,onChange:t=>m({...i,nama:t.target.value}),disabled:x,placeholder:"Nama Lengkap Pasien",className:"pl-10"}),e.jsx("div",{className:"absolute inset-y-0 left-0 flex items-center pl-3",children:e.jsx(G,{className:"h-4 w-4 text-slate-400"})})]}),e.jsx(T,{message:j.nama,className:"mt-2"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(S,{htmlFor:"tempat_lahir",className:"flex items-center gap-2",children:[e.jsx(U,{className:"h-4 w-4 text-slate-500"}),"Tempat Lahir"]}),e.jsxs("div",{className:"relative",children:[e.jsx(v,{id:"tempat_lahir",type:"text",required:!0,tabIndex:2,autoComplete:"tempat_lahir",value:i.tempat_lahir,onChange:t=>m({...i,tempat_lahir:t.target.value}),disabled:x,placeholder:"Kota tempat lahir",className:"pl-10"}),e.jsx("div",{className:"absolute inset-y-0 left-0 flex items-center pl-3",children:e.jsx(U,{className:"h-4 w-4 text-slate-400"})})]}),e.jsx(T,{message:j.tempat_lahir})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(S,{htmlFor:"tanggal_lahir",className:"flex items-center gap-2",children:[e.jsx(R,{className:"h-4 w-4 text-slate-500"}),"Tanggal Lahir"]}),e.jsxs("div",{className:"relative",children:[e.jsx(v,{id:"tanggal_lahir",type:"date",required:!0,tabIndex:2,max:xe,min:ue,autoComplete:"tanggal_lahir",value:i.tanggal_lahir,onChange:t=>ie(t),disabled:x,className:"pl-10"}),e.jsx("div",{className:"absolute inset-y-0 left-0 flex items-center pl-3",children:e.jsx(R,{className:"h-4 w-4 text-slate-400"})})]}),e.jsx(T,{message:j.tanggal_lahir})]})]})]}),e.jsx(Ce,{kriteria:f,data:i,setData:m,handleChange:ne,handleSelectChange:oe,processing:x}),e.jsx("div",{className:"pt-4",children:e.jsxs(D,{type:"submit",disabled:_||!B||te,className:"w-full bg-gradient-to-r from-green-600 to-emerald-600 py-3 font-medium text-white shadow-md transition-all hover:from-green-700 hover:to-emerald-700 hover:shadow-lg disabled:opacity-50",children:[_?e.jsx(V,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(Be,{className:"mr-2 h-4 w-4"}),_?"Memproses...":"Analisis Status Gizi"]})})]})})]}),e.jsxs(we,{open:se,onOpenChange:H,children:[e.jsx(ye,{}),e.jsxs(ke,{className:"max-w-4xl overflow-hidden rounded-2xl p-0",children:[e.jsx("div",{className:"bg-gradient-to-r from-green-500 to-emerald-600 p-6 text-white",children:e.jsxs(ve,{className:"flex items-center gap-3 text-white",children:[e.jsx("div",{className:"flex h-10 w-10 items-center justify-center rounded-full bg-white/20",children:e.jsx(J,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold",children:"Hasil Analisis Status Gizi"}),e.jsx("p",{className:"text-sm opacity-90",children:"Rekomendasi berdasarkan kondisi kesehatan"})]})]})}),e.jsxs("div",{className:"max-h-[70vh] overflow-y-auto p-6",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-6 rounded-xl border border-slate-200 bg-slate-50 p-5",children:[e.jsxs("h3",{className:"flex items-center gap-2 text-lg font-semibold text-slate-800",children:[e.jsx(E,{className:"h-5 w-5 text-slate-600"}),"Informasi Pasien"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between border-b border-slate-200 pb-2",children:[e.jsx("span",{className:"text-slate-600",children:"Nama"}),e.jsx("span",{className:"font-medium",children:i.nama||"-"})]}),e.jsxs("div",{className:"flex justify-between border-b border-slate-200 pb-2",children:[e.jsx("span",{className:"text-slate-600",children:"Tanggal Lahir"}),e.jsx("span",{className:"font-medium",children:i.tanggal_lahir||"-"})]}),e.jsxs("div",{className:"flex justify-between border-b border-slate-200 pb-2",children:[e.jsx("span",{className:"text-slate-600",children:"Usia"}),e.jsx("span",{className:"font-medium",children:ge(i.tanggal_lahir)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-600",children:"Tempat Lahir"}),e.jsx("span",{className:"font-medium",children:i.tempat_lahir||"-"})]})]})]}),e.jsxs("div",{className:"space-y-6 rounded-xl border border-slate-200 bg-slate-50 p-5",children:[e.jsxs("h3",{className:"flex items-center gap-2 text-lg font-semibold text-slate-800",children:[e.jsx(Fe,{className:"h-5 w-5 text-slate-600"}),"Status Gizi"]}),e.jsxs("div",{className:"flex flex-col items-center justify-center space-y-4 py-2",children:[e.jsx("div",{className:`rounded-full p-1 ${(n==null?void 0:n.label)==="beresiko"?"bg-red-100":(n==null?void 0:n.label)==="gizi buruk"?"bg-yellow-100":(n==null?void 0:n.label)==="gizi normal"?"bg-green-100":"bg-blue-100"}`,children:e.jsx("div",{className:`flex h-24 w-24 items-center justify-center rounded-full ${(n==null?void 0:n.label)==="beresiko"?"bg-red-500":(n==null?void 0:n.label)==="gizi buruk"?"bg-yellow-500":(n==null?void 0:n.label)==="gizi normal"?"bg-green-500":"bg-blue-500"}`,children:(n==null?void 0:n.label)==="gizi normal"?e.jsx(Z,{className:"h-10 w-10 text-white"}):e.jsx(Me,{className:"h-10 w-10 text-white"})})}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm font-medium text-slate-600",children:"Status IMT"}),e.jsx("p",{className:`rounded-2xl p-2 text-xl font-bold ${fe}`,children:(n==null?void 0:n.label)||"-"})]})]})]})]}),e.jsxs("div",{className:"mt-6 rounded-xl border border-slate-200 bg-slate-50 p-5",children:[e.jsxs("h3",{className:"mb-4 flex items-center gap-2 text-lg font-semibold text-slate-800",children:[e.jsx(Pe,{className:"h-5 w-5 text-slate-600"}),"Rekomendasi Gizi"]}),e.jsx(Ee,{data:i.statusGizi})]}),e.jsx("div",{className:"mt-6",children:e.jsxs(D,{type:"button",variant:"default",size:"sm",className:"w-full bg-gradient-to-r from-green-600 to-emerald-600 py-3 font-medium text-white shadow-md transition-all hover:from-green-700 hover:to-emerald-700 hover:shadow-lg",disabled:x,onClick:X,children:[x?e.jsx(V,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(Z,{className:"mr-2 h-4 w-4"}),x?"Menyimpan...":"Simpan Hasil Analisis"]})})]})]})]})]})})};export{rs as F};
