import{K as se,r as d,j as e,b as J,m as pe,L as be}from"./app-DjOIQuK1.js";import{D as je,e as Ne,a as we,c as ye}from"./dialog-Dc6LFye_.js";import{I as P}from"./input-DXuzG_Sx.js";import{L as M}from"./label-oxInZsZV.js";import{T as te}from"./use-mobile-navigation-9RenQoFI.js";import{S as ve}from"./algorithm-model-DsEtNbAw.js";import{F as ke}from"./form-loop-kriteria-CR2Nck6q.js";import{I as z}from"./input-error-cUs0QmyL.js";import{L as Q,H as Se,T as Ce}from"./table-label-sayuran-ATkU8S0N.js";import{B as $}from"./button-DIvv25p0.js";import{U as A}from"./user-BIGnYb9n.js";import{P as W}from"./person-standing-DUNb-qsH.js";import{M as X}from"./map-pin-B_xj9AEV.js";import{C as Z}from"./calendar-CUECNgA5.js";import{L as ee}from"./loader-circle-nwD6YEdJ.js";import{A as _e}from"./activity-C9VL5YfF.js";import{S as Te}from"./scale-BFJzvawe.js";import{C as ae}from"./circle-check-big-oTqdqVz_.js";import{C as Le}from"./circle-alert-0YmQru2f.js";import{C as Be,a as Pe}from"./card-wAIgvV7S.js";import{U as Me}from"./user-auth-layout-DBKRBoby.js";import"./index-BKmIqAC4.js";import"./index-I47ZBckP.js";import"./proxy-CpYiiuML.js";import"./select-DYRcLHbQ.js";import"./check-CtZFz5q-.js";import"./react-icons.esm-D4GlyG_k.js";import"./chevron-down-DObL8Hgh.js";import"./table-Bq4WtGd9.js";import"./clipboard-list-By1sJxXD.js";import"./baby-BpgXhadr.js";import"./index-C_ylxQhX.js";const ze=({data:n,setData:h,processing:m,errors:j,kriteria:p,setResult:f,setFeature:k,submit:N})=>{const{auth:D}=se().props,[S,w]=d.useState(!1),[F,v]=d.useState(null),[y]=d.useState(new ve),[I,C]=d.useState(!1),[t,x]=d.useState(null),[_,T]=d.useState(!1),H=new Date,[E,le]=d.useState(n.nik||""),[L,b]=d.useState({title:"",show:!1,message:"",type:"success"}),re=d.useCallback(l=>{const{value:a}=l.target,s=p.findIndex(r=>r.nama.toLowerCase().includes("umur")),o=ue(a);h(r=>{var i;return{...r,tanggal_lahir:a,kriteria:(i=r.kriteria)==null?void 0:i.map((c,u)=>u===s?{...c,nilai:o.toString()}:c)}})},[n,h]),ie=d.useCallback(l=>{const{name:a,value:s}=l.target,[o,r]=a.split("."),i=Number(r);o==="kriteria"?(s===""||/^-?\d*\.?\d*$/.test(s))&&h(c=>{var q,K,R;const u=(q=c.kriteria)==null?void 0:q.map((g,B)=>B===i?{...g,nilai:s}:g),G=p.findIndex(g=>g.nama.includes("BB")),O=p.findIndex(g=>g.nama.includes("TB")),Y=p.findIndex(g=>g.nama.toLowerCase().includes("imt"));if((i===G||i===O)&&Y!==-1){const g=Number(i===G?s:((K=u==null?void 0:u[G])==null?void 0:K.nilai)??0),B=Number(i===O?s:((R=u==null?void 0:u[O])==null?void 0:R.nilai)??0);if(g>0&&B>0)return{...c,kriteria:u==null?void 0:u.map((V,fe)=>fe===Y?{...V,nilai:ge(g,B)}:V)}}return{...c,kriteria:u}}):h(c=>({...c,[a]:s}))},[p,h]),ne=(l,a)=>{l&&a!==void 0&&n&&n.kriteria?h(l==="label"?s=>({...s,[l]:a}):s=>{var o;return{...s,kriteria:(o=s.kriteria)==null?void 0:o.map((r,i)=>i===Number(l)?{...r,nilai:a}:r)}}):console.error("Invalid data: name, value, or kriteria may be undefined")},oe=async l=>{try{const a=await J.get(route("api.get.label-sayuran-by-label",{label:l}));if(a.status!==200)throw new Error("Failed to fetch rekomendasi makanan");const s=await a.data;console.log(s),h(o=>({...o,statusGizi:s}))}catch(a){return console.error(a),b({title:"Error",show:!0,message:a.message,type:"error"}),null}};d.useEffect(()=>{(async()=>{w(!0);try{const a=await y.fetchAndProcessData();await y.loadModel(),v(a)}catch(a){b({title:"Error",show:!0,message:`${a.message}, Lakukan training pada halaman decision Tree sebelum masuk Pemeriksaan Gizi Ibu Hamil`,type:"error"}),T(!0)}finally{w(!1)}})()},[]);const me=l=>{const a=J.get(route("api.get.pasien-by-nik",{nik:l}));a&&a.then(s=>{const o=s.data;h(r=>({...r,nama:o.nama,tempat_lahir:o.tempat_lahir,tanggal_lahir:o.tanggal_lahir,jenis_kelamin:o.jenis_kelamin,alamat:o.alamat}))}).catch(s=>{console.log(s)})},ce=async l=>{var a,s;l.preventDefault(),w(!0);try{const o=(a=n.kriteria)==null?void 0:a.map(r=>{const i=r.nilai;(i==null||i==="")&&b({title:"Error",show:!0,message:"Nilai jenis kelamin, usia,  BB, TB, IMT Tidak Boleh Kosong ",type:"error"});const c=String(i).toLowerCase();return c==="laki-laki"?0:c==="perempuan"?1:c==="kurang"?0:c==="sedang"?1:c==="baik"?2:!isNaN(parseFloat(i))&&isFinite(i)?parseFloat(i):i});if(n.nik===""||n.nama===""||n.tempat_lahir==="")console.log(n.nik,n.nama),b({title:"Error",show:!0,message:"NIK, Nama, Orang Tua, Tempat Lahir Tidak Boleh Kosong ",type:"error"});else{const r=await y.predict([o??[]]);if(r.error)b({title:"Hasil Prediksi",show:!0,message:r.error,type:"success"});else if(x(r),k&&k(n.kriteria),r.label!==void 0&&r.label!==null){const i=r.label.toString();h(c=>({...c,label:i})),f(r),oe(((s=r.label)==null?void 0:s.toString())??""),de()}}}catch(o){console.error(o),b({title:"Hasil Prediksi",show:!0,message:o,type:"success"})}finally{w(!1)}};d.useEffect(()=>{t&&t.label&&(console.log("Prediction label changed:",t.label),h("label",t.label.toString()))},[t]);const de=()=>{C(!0)},U=new Date(H);U.setFullYear(H.getFullYear()-1),U.toISOString().split("T")[0];function he(l){const a=new Date(l),s=new Date;let o=s.getFullYear()-a.getFullYear(),r=s.getMonth()-a.getMonth(),i=s.getDate()-a.getDate();return i<0&&(r--,i+=new Date(s.getFullYear(),s.getMonth(),0).getDate()),r<0&&(o--,r+=12),`${o} tahun, ${r} bulan, ${i} hari`}function ue(l){const a=new Date(l),s=new Date;let o=s.getFullYear()-a.getFullYear(),r=s.getMonth()-a.getMonth(),i=s.getDate()-a.getDate(),c=o*12+r;return i<0&&(c-=1),c.toString()}const xe=d.useMemo(()=>{if(!t)return"";switch(t.label){case"beresiko":return"bg-red-100 border-red-300 text-red-800";case"gizi buruk":return"bg-yellow-100 border-yellow-300 text-yellow-800";case"gizi normal":return"bg-green-100 border-green-300 text-green-800";default:return"bg-blue-100 border-blue-300 text-blue-800"}},[t]),ge=(l,a)=>{const s=a/100;return(l/(s*s)).toFixed(3)};return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-blue-50 px-4 py-8",children:e.jsxs("div",{className:"mx-auto max-w-4xl",children:[e.jsx(te,{open:L.show,onOpenChange:()=>b(l=>({...l,show:!1})),title:L.title,description:L.message,duration:1e4,variant:L.type}),e.jsxs("div",{className:"mb-8 text-center",children:[e.jsxs("div",{className:"inline-flex items-center gap-3 rounded-full bg-white px-4 py-2 shadow-sm",children:[e.jsx("div",{className:"flex h-10 w-10 items-center justify-center rounded-full bg-green-100",children:e.jsx(Q,{className:"h-5 w-5 text-green-600"})}),e.jsx("h1",{className:"text-xl font-bold text-slate-800",children:"Deteksi Status Gizi Ibu Hamil"})]}),e.jsx("p",{className:"mt-3 text-slate-600",children:"Sistem prediksi status gizi menggunakan metode SVM"})]}),e.jsxs("div",{className:"overflow-hidden rounded-2xl border border-slate-200 bg-white shadow-lg",children:[e.jsxs("div",{className:"bg-gradient-to-r from-green-500 to-emerald-600 p-4 text-white",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Data Pasien"}),e.jsx("p",{className:"text-sm opacity-90",children:"Lengkapi informasi di bawah untuk analisis gizi"})]}),e.jsx("div",{className:"p-6 md:p-8",children:e.jsxs("form",{onSubmit:l=>ce(l),className:"space-y-6",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(M,{htmlFor:"nik",className:"flex items-center gap-2",children:[e.jsx(A,{className:"h-4 w-4 text-slate-500"}),"NIK Pasien"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(P,{id:"nik",type:"text",required:!0,tabIndex:1,autoComplete:"nik",value:E,onChange:l=>{const a=l.target.value;/^\d*$/.test(a)&&a.length<=16&&(h(s=>({...s,nik:a})),le(a))},disabled:m,placeholder:"Masukkan NIK Pasien",className:"pl-10"}),e.jsx("div",{className:"absolute inset-y-0 left-0 flex items-center pl-3",children:e.jsx(A,{className:"h-4 w-4 text-slate-400"})})]}),e.jsx($,{type:"button",variant:"outline",onClick:()=>{E.length<=16?me(Number(E)):b({title:"Error",show:!0,message:"NIK harus 16 digit",type:"error"})},children:"Cari"})]}),e.jsx(z,{message:j.nik,className:"mt-2"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(M,{htmlFor:"nama",className:"flex items-center gap-2",children:[e.jsx(W,{className:"h-4 w-4 text-slate-500"}),"Nama Pasien"]}),e.jsxs("div",{className:"relative",children:[e.jsx(P,{id:"nama",type:"text",required:!0,tabIndex:1,autoComplete:"nama",value:n.nama,onChange:l=>h({...n,nama:l.target.value}),disabled:m,placeholder:"Nama Lengkap Pasien",className:"pl-10"}),e.jsx("div",{className:"absolute inset-y-0 left-0 flex items-center pl-3",children:e.jsx(W,{className:"h-4 w-4 text-slate-400"})})]}),e.jsx(z,{message:j.nama,className:"mt-2"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(M,{htmlFor:"tempat_lahir",className:"flex items-center gap-2",children:[e.jsx(X,{className:"h-4 w-4 text-slate-500"}),"Tempat Lahir"]}),e.jsxs("div",{className:"relative",children:[e.jsx(P,{id:"tempat_lahir",type:"text",required:!0,tabIndex:2,autoComplete:"tempat_lahir",value:n.tempat_lahir,onChange:l=>h({...n,tempat_lahir:l.target.value}),disabled:m,placeholder:"Kota tempat lahir",className:"pl-10"}),e.jsx("div",{className:"absolute inset-y-0 left-0 flex items-center pl-3",children:e.jsx(X,{className:"h-4 w-4 text-slate-400"})})]}),e.jsx(z,{message:j.tempat_lahir})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(M,{htmlFor:"tanggal_lahir",className:"flex items-center gap-2",children:[e.jsx(Z,{className:"h-4 w-4 text-slate-500"}),"Tanggal Lahir"]}),e.jsxs("div",{className:"relative",children:[e.jsx(P,{id:"tanggal_lahir",type:"date",required:!0,tabIndex:2,autoComplete:"tanggal_lahir",value:n.tanggal_lahir,onChange:l=>re(l),disabled:m,className:"pl-10"}),e.jsx("div",{className:"absolute inset-y-0 left-0 flex items-center pl-3",children:e.jsx(Z,{className:"h-4 w-4 text-slate-400"})})]}),e.jsx(z,{message:j.tanggal_lahir})]})]})]}),e.jsx(ke,{kriteria:p,data:n,setData:h,handleChange:ie,handleSelectChange:ne,processing:m}),e.jsx("div",{className:"pt-4",children:e.jsxs($,{type:"submit",disabled:S||!y||_,className:"w-full bg-gradient-to-r from-green-600 to-emerald-600 py-3 font-medium text-white shadow-md transition-all hover:from-green-700 hover:to-emerald-700 hover:shadow-lg disabled:opacity-50",children:[S?e.jsx(ee,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(_e,{className:"mr-2 h-4 w-4"}),S?"Memproses...":"Analisis Status Gizi"]})})]})})]}),e.jsxs(je,{open:I,onOpenChange:C,children:[e.jsx(Ne,{}),e.jsxs(we,{className:"max-w-4xl overflow-hidden rounded-2xl p-0",children:[e.jsx("div",{className:"bg-gradient-to-r from-green-500 to-emerald-600 p-6 text-white",children:e.jsxs(ye,{className:"flex items-center gap-3 text-white",children:[e.jsx("div",{className:"flex h-10 w-10 items-center justify-center rounded-full bg-white/20",children:e.jsx(Q,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold",children:"Hasil Analisis Status Gizi"}),e.jsx("p",{className:"text-sm opacity-90",children:"Rekomendasi berdasarkan kondisi kesehatan"})]})]})}),e.jsxs("div",{className:"max-h-[70vh] overflow-y-auto p-6",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-6 rounded-xl border border-slate-200 bg-slate-50 p-5",children:[e.jsxs("h3",{className:"flex items-center gap-2 text-lg font-semibold text-slate-800",children:[e.jsx(A,{className:"h-5 w-5 text-slate-600"}),"Informasi Pasien"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between border-b border-slate-200 pb-2",children:[e.jsx("span",{className:"text-slate-600",children:"Nama"}),e.jsx("span",{className:"font-medium",children:n.nama||"-"})]}),e.jsxs("div",{className:"flex justify-between border-b border-slate-200 pb-2",children:[e.jsx("span",{className:"text-slate-600",children:"Tanggal Lahir"}),e.jsx("span",{className:"font-medium",children:n.tanggal_lahir||"-"})]}),e.jsxs("div",{className:"flex justify-between border-b border-slate-200 pb-2",children:[e.jsx("span",{className:"text-slate-600",children:"Usia"}),e.jsx("span",{className:"font-medium",children:he(n.tanggal_lahir)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-600",children:"Tempat Lahir"}),e.jsx("span",{className:"font-medium",children:n.tempat_lahir||"-"})]})]})]}),e.jsxs("div",{className:"space-y-6 rounded-xl border border-slate-200 bg-slate-50 p-5",children:[e.jsxs("h3",{className:"flex items-center gap-2 text-lg font-semibold text-slate-800",children:[e.jsx(Te,{className:"h-5 w-5 text-slate-600"}),"Status Gizi"]}),e.jsxs("div",{className:"flex flex-col items-center justify-center space-y-4 py-2",children:[e.jsx("div",{className:`rounded-full p-1 ${(t==null?void 0:t.label)==="beresiko"?"bg-red-100":(t==null?void 0:t.label)==="gizi buruk"?"bg-yellow-100":(t==null?void 0:t.label)==="gizi normal"?"bg-green-100":"bg-blue-100"}`,children:e.jsx("div",{className:`flex h-24 w-24 items-center justify-center rounded-full ${(t==null?void 0:t.label)==="beresiko"?"bg-red-500":(t==null?void 0:t.label)==="gizi buruk"?"bg-yellow-500":(t==null?void 0:t.label)==="gizi normal"?"bg-green-500":"bg-blue-500"}`,children:(t==null?void 0:t.label)==="gizi normal"?e.jsx(ae,{className:"h-10 w-10 text-white"}):e.jsx(Le,{className:"h-10 w-10 text-white"})})}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm font-medium text-slate-600",children:"Status IMT"}),e.jsx("p",{className:`rounded-2xl p-2 text-xl font-bold ${xe}`,children:(t==null?void 0:t.label)||"-"})]})]})]})]}),e.jsxs("div",{className:"mt-6 rounded-xl border border-slate-200 bg-slate-50 p-5",children:[e.jsxs("h3",{className:"mb-4 flex items-center gap-2 text-lg font-semibold text-slate-800",children:[e.jsx(Se,{className:"h-5 w-5 text-slate-600"}),"Rekomendasi Gizi"]}),e.jsx(Ce,{data:n.statusGizi})]}),e.jsx("div",{className:"mt-6",children:e.jsxs($,{type:"button",variant:"default",size:"sm",className:"w-full bg-gradient-to-r from-green-600 to-emerald-600 py-3 font-medium text-white shadow-md transition-all hover:from-green-700 hover:to-emerald-700 hover:shadow-lg",disabled:m,onClick:N,children:[m?e.jsx(ee,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(ae,{className:"mr-2 h-4 w-4"}),m?"Menyimpan...":"Simpan Hasil Analisis"]})})]})]})]})]})})};function ha({breadcrumb:n,pasien:h,pasienId:m,kriteria:j}){const{auth:p}=se().props;d.useMemo(()=>n?n.map(x=>({title:x.title,href:x.href})):[],[n]);const[f,k]=d.useState(null),[N,D]=d.useState({title:"",show:!1,message:"",type:"success"}),w=new Date().toISOString().split("T")[0],{data:F,setData:v,post:y,processing:I,errors:C}=pe({rme:"",nik:m?m.nik:"",user_id:p.user.id.toString(),nama:m?m.nama:"",tempat_lahir:m?m.tempat_lahir:"",tanggal_lahir:m?m.tanggal_lahir:"",jenis_kelamin:m?m.jenis_kelamin:"",alamat:m?m.user.alamat:"",tanggal_pemeriksaan:w,kriteria:j.map(x=>({nilai:null,kriteria_id:x.id.toString(),name:x.nama})),label:"",alasan:"",rekomendasi:[],usia_pasien:"",detail:[],statusGizi:[]}),t=x=>{var _;x.preventDefault(),F.label==""?v("label",((_=f==null?void 0:f.label)==null?void 0:_.toString())??""):y(route("pemeriksaan.store"),{onError:T=>{console.log(T),D({title:"Error",show:!0,message:JSON.stringify(T),type:"error"})},preserveState:!0})};return d.useEffect(()=>{f&&f.label&&v("label",f.label.toString())},[f]),console.log(m),e.jsxs(Me,{children:[e.jsx(be,{title:"Create"}),e.jsx(te,{open:N.show,onOpenChange:()=>D(x=>({...x,show:!1})),title:N.title,description:N.message,duration:5e3,variant:N.type}),e.jsx(Be,{className:"border-none shadow-none",children:e.jsx(Pe,{className:"p-6",children:e.jsx("div",{className:"grid gap-8",children:e.jsx(ze,{submit:t,kriteria:j,setResult:k,data:F,setData:v,processing:I,errors:C})})})})]})}export{ha as default};
