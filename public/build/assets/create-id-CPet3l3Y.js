import{K as se,r as h,j as e,b as Y,m as je,L as Ne}from"./app-CtyQMShl.js";import{D as we,e as ve,a as ye,c as ke}from"./dialog-Gs9cO-hH.js";import{I as B}from"./input-zzBCrUmn.js";import{L as F}from"./label-CwY4dQuC.js";import{T as ae}from"./use-mobile-navigation-CqwbcmHL.js";import{S as Se}from"./algorithm-model-Ch2cDhZL.js";import{F as Ce}from"./form-loop-kriteria-XIdXU7ir.js";import{I as M}from"./input-error-DDtvig7V.js";import{L as J,H as Te,T as Ie}from"./table-label-sayuran-Nih27KV5.js";import{B as A}from"./button-CEGAKamD.js";import{U as $}from"./user-C-T6P-I-.js";import{P as Q}from"./person-standing-DFp4MHuH.js";import{M as W}from"./map-pin-44bCeRXs.js";import{C as X}from"./calendar-B4VizCh7.js";import{L as Z}from"./loader-circle-CC7l6Dak.js";import{A as _e}from"./activity-BZAXTkps.js";import{S as Le}from"./scale-2HcQUxWY.js";import{C as ee}from"./circle-check-big-LIFqZTx9.js";import{C as Be}from"./circle-alert-dDJdzqnS.js";import{C as Fe,a as Me}from"./card-WDHv8olA.js";import{A as ze}from"./app-layout-DmoG1NJh.js";import"./index-RQQ98Qls.js";import"./index-CzBgmq_r.js";import"./proxy-BeWjhPMz.js";import"./select-CgVkm6wk.js";import"./check-SDN0y55D.js";import"./react-icons.esm-CPdtnUe_.js";import"./chevron-down-DTt3n8Oy.js";import"./table-BCpLA_kQ.js";const Pe=({data:n,setData:d,processing:p,errors:u,kriteria:f,setResult:N,setFeature:v,submit:H})=>{const{auth:te}=se().props,[y,j]=h.useState(!1),[x,z]=h.useState(null),[k]=h.useState(new Se),[P,S]=h.useState(!1),[t,C]=h.useState(null),[T,D]=h.useState(!1),E=new Date,[G,le]=h.useState(""),[I,b]=h.useState({title:"",show:!1,message:"",type:"success"}),re=h.useCallback(l=>{const{value:s}=l.target,a=f.findIndex(r=>r.nama.toLowerCase().includes("umur")),o=ge(s);d(r=>{var i;return{...r,tanggal_lahir:s,kriteria:(i=r.kriteria)==null?void 0:i.map((m,c)=>c===a?{...m,nilai:o.toString()}:m)}})},[n,d]),ie=h.useCallback(l=>{const{name:s,value:a}=l.target,[o,r]=s.split("."),i=Number(r);o==="kriteria"?(a===""||/^-?\d*\.?\d*$/.test(a))&&d(m=>{var U,q,R;const c=(U=m.kriteria)==null?void 0:U.map((g,L)=>L===i?{...g,nilai:a}:g),w=f.findIndex(g=>g.nama.includes("BB")),O=f.findIndex(g=>g.nama.includes("TB")),K=f.findIndex(g=>g.nama.toLowerCase().includes("imt"));if((i===w||i===O)&&K!==-1){const g=Number(i===w?a:((q=c==null?void 0:c[w])==null?void 0:q.nilai)??0),L=Number(i===O?a:((R=c==null?void 0:c[O])==null?void 0:R.nilai)??0);if(g>0&&L>0)return{...m,kriteria:c==null?void 0:c.map((V,be)=>be===K?{...V,nilai:fe(g,L)}:V)}}return{...m,kriteria:c}}):d(m=>({...m,[s]:a}))},[f,d]),ne=(l,s)=>{l&&s!==void 0&&n&&n.kriteria?d(l==="label"?a=>({...a,[l]:s}):a=>{var o;return{...a,kriteria:(o=a.kriteria)==null?void 0:o.map((r,i)=>i===Number(l)?{...r,nilai:s}:r)}}):console.error("Invalid data: name, value, or kriteria may be undefined")},oe=async l=>{try{const s=await Y.get(route("api.get.label-sayuran-by-label",{label:l}));if(s.status!==200)throw new Error("Failed to fetch rekomendasi makanan");const a=await s.data;console.log(a),d(o=>({...o,statusGizi:a}))}catch(s){return console.error(s),b({title:"Error",show:!0,message:s.message,type:"error"}),null}};h.useEffect(()=>{(async()=>{j(!0);try{const s=await k.fetchAndProcessData();await k.loadModel(),console.log(s),z(s)}catch(s){b({title:"Error",show:!0,message:`${s.message}, Lakukan training pada halaman decision Tree sebelum masuk Pemeriksaan Gizi Ibu Hamil`,type:"error"}),D(!0)}finally{j(!1)}})()},[]);const me=l=>{const s=Y.get(route("api.get.pasien-by-nik",{nik:l}));s&&s.then(a=>{const o=a.data;d(r=>({...r,nama:o.nama,tempat_lahir:o.tempat_lahir,tanggal_lahir:o.tanggal_lahir,jenis_kelamin:o.jenis_kelamin,alamat:o.alamat}))}).catch(a=>{console.log(a)})},de=async l=>{var s;l.preventDefault(),j(!0);try{const a=(s=n.kriteria)==null?void 0:s.map(o=>{const r=o.nilai;(r==null||r==="")&&b({title:"Error",show:!0,message:"Nilai jenis kelamin, usia,  BB, TB, IMT Tidak Boleh Kosong ",type:"error"});const i=String(r).toLowerCase();return i==="laki-laki"?0:i==="perempuan"?1:i==="kurang"?0:i==="sedang"?1:i==="baik"?2:!isNaN(parseFloat(r))&&isFinite(r)?parseFloat(r):r});if(n.nik===""||n.nama===""||n.tempat_lahir==="")console.log(n.nik,n.nama),b({title:"Error",show:!0,message:"NIK, Nama, Orang Tua, Tempat Lahir Tidak Boleh Kosong ",type:"error"});else{const o={trainingData:x==null?void 0:x.features,className:x==null?void 0:x.labelsY,inputFeature:a},r=await Y.post("https://delapain.my.id/api/svm/",o),i=x==null?void 0:x.label.find((c,w)=>c.id===r.data.result),m=i==null?void 0:i.nama;if(r.data.status!=="success")b({title:"Hasil Prediksi",show:!0,message:r.data.status,type:"error"});else if(C({prediction:r.data.result,label:m??null,rekomendasi:(i==null?void 0:i.deskripsi)??null,error:null}),v&&v(n.kriteria),m!=null){const c=m.toString();d(w=>({...w,label:c})),N({prediction:r.data.result,label:m??null,rekomendasi:(i==null?void 0:i.deskripsi)??null,error:null}),oe((m==null?void 0:m.toString())??""),ce()}}}catch(a){console.error(a),b({title:"Hasil Prediksi",show:!0,message:a,type:"success"})}finally{j(!1)}},ce=()=>{S(!0)},_=new Date(E);_.setFullYear(E.getFullYear()-12);const he=_.toISOString().split("T")[0];_.setFullYear(E.getFullYear()-51);const ue=_.toISOString().split("T")[0];function xe(l){const s=new Date(l),a=new Date;let o=a.getFullYear()-s.getFullYear(),r=a.getMonth()-s.getMonth(),i=a.getDate()-s.getDate();return i<0&&(r--,i+=new Date(a.getFullYear(),a.getMonth(),0).getDate()),r<0&&(o--,r+=12),`${o} tahun, ${r} bulan, ${i} hari`}function ge(l){const s=new Date(l),a=new Date;let o=a.getFullYear()-s.getFullYear(),r=a.getMonth()-s.getMonth(),i=a.getDate()-s.getDate(),m=o*12+r;return i<0&&(m-=1),m.toString()}const pe=h.useMemo(()=>{if(!t)return"";switch(t.label){case"beresiko":return"bg-red-100 border-red-300 text-red-800";case"gizi buruk":return"bg-yellow-100 border-yellow-300 text-yellow-800";case"gizi normal":return"bg-green-100 border-green-300 text-green-800";default:return"bg-blue-100 border-blue-300 text-blue-800"}},[t]),fe=(l,s)=>{const a=s/100;return(l/(a*a)).toFixed(3)};return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-blue-50 px-4 py-8",children:e.jsxs("div",{className:"mx-auto max-w-4xl",children:[e.jsx(ae,{open:I.show,onOpenChange:()=>b(l=>({...l,show:!1})),title:I.title,description:I.message,duration:1e4,variant:I.type}),e.jsxs("div",{className:"mb-8 text-center",children:[e.jsxs("div",{className:"inline-flex items-center gap-3 rounded-full bg-white px-4 py-2 shadow-sm",children:[e.jsx("div",{className:"flex h-10 w-10 items-center justify-center rounded-full bg-green-100",children:e.jsx(J,{className:"h-5 w-5 text-green-600"})}),e.jsx("h1",{className:"text-xl font-bold text-slate-800",children:"Deteksi Status Gizi Ibu Hamil"})]}),e.jsx("p",{className:"mt-3 text-slate-600",children:"Sistem prediksi status gizi menggunakan metode SVM"})]}),e.jsxs("div",{className:"overflow-hidden rounded-2xl border border-slate-200 bg-white shadow-lg",children:[e.jsxs("div",{className:"bg-gradient-to-r from-green-500 to-emerald-600 p-4 text-white",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Data Pasien"}),e.jsx("p",{className:"text-sm opacity-90",children:"Lengkapi informasi di bawah untuk analisis gizi"})]}),e.jsx("div",{className:"p-6 md:p-8",children:e.jsxs("form",{onSubmit:l=>de(l),className:"space-y-6",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(F,{htmlFor:"nik",className:"flex items-center gap-2",children:[e.jsx($,{className:"h-4 w-4 text-slate-500"}),"NIK Pasien"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(B,{id:"nik",type:"text",required:!0,tabIndex:1,autoComplete:"nik",value:G,onChange:l=>{const s=l.target.value;/^\d*$/.test(s)&&s.length<=16&&(d(a=>({...a,nik:s})),le(s))},disabled:p,placeholder:"Masukkan NIK Pasien",className:"pl-10"}),e.jsx("div",{className:"absolute inset-y-0 left-0 flex items-center pl-3",children:e.jsx($,{className:"h-4 w-4 text-slate-400"})})]}),e.jsx(A,{type:"button",variant:"outline",onClick:()=>{G.length<=16?me(Number(G)):b({title:"Error",show:!0,message:"NIK harus 16 digit",type:"error"})},children:"Cari"})]}),e.jsx(M,{message:u.nik,className:"mt-2"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(F,{htmlFor:"nama",className:"flex items-center gap-2",children:[e.jsx(Q,{className:"h-4 w-4 text-slate-500"}),"Nama Pasien"]}),e.jsxs("div",{className:"relative",children:[e.jsx(B,{id:"nama",type:"text",required:!0,tabIndex:1,autoComplete:"nama",value:n.nama,onChange:l=>d({...n,nama:l.target.value}),disabled:p,placeholder:"Nama Lengkap Pasien",className:"pl-10"}),e.jsx("div",{className:"absolute inset-y-0 left-0 flex items-center pl-3",children:e.jsx(Q,{className:"h-4 w-4 text-slate-400"})})]}),e.jsx(M,{message:u.nama,className:"mt-2"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(F,{htmlFor:"tempat_lahir",className:"flex items-center gap-2",children:[e.jsx(W,{className:"h-4 w-4 text-slate-500"}),"Tempat Lahir"]}),e.jsxs("div",{className:"relative",children:[e.jsx(B,{id:"tempat_lahir",type:"text",required:!0,tabIndex:2,autoComplete:"tempat_lahir",value:n.tempat_lahir,onChange:l=>d({...n,tempat_lahir:l.target.value}),disabled:p,placeholder:"Kota tempat lahir",className:"pl-10"}),e.jsx("div",{className:"absolute inset-y-0 left-0 flex items-center pl-3",children:e.jsx(W,{className:"h-4 w-4 text-slate-400"})})]}),e.jsx(M,{message:u.tempat_lahir})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(F,{htmlFor:"tanggal_lahir",className:"flex items-center gap-2",children:[e.jsx(X,{className:"h-4 w-4 text-slate-500"}),"Tanggal Lahir"]}),e.jsxs("div",{className:"relative",children:[e.jsx(B,{id:"tanggal_lahir",type:"date",required:!0,tabIndex:2,max:he,min:ue,autoComplete:"tanggal_lahir",value:n.tanggal_lahir,onChange:l=>re(l),disabled:p,className:"pl-10"}),e.jsx("div",{className:"absolute inset-y-0 left-0 flex items-center pl-3",children:e.jsx(X,{className:"h-4 w-4 text-slate-400"})})]}),e.jsx(M,{message:u.tanggal_lahir})]})]})]}),e.jsx(Ce,{kriteria:f,data:n,setData:d,handleChange:ie,handleSelectChange:ne,processing:p}),e.jsx("div",{className:"pt-4",children:e.jsxs(A,{type:"submit",disabled:y||!k||T,className:"w-full bg-gradient-to-r from-green-600 to-emerald-600 py-3 font-medium text-white shadow-md transition-all hover:from-green-700 hover:to-emerald-700 hover:shadow-lg disabled:opacity-50",children:[y?e.jsx(Z,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(_e,{className:"mr-2 h-4 w-4"}),y?"Memproses...":"Analisis Status Gizi"]})})]})})]}),e.jsxs(we,{open:P,onOpenChange:S,children:[e.jsx(ve,{}),e.jsxs(ye,{className:"max-w-4xl overflow-hidden rounded-2xl p-0",children:[e.jsx("div",{className:"bg-gradient-to-r from-green-500 to-emerald-600 p-6 text-white",children:e.jsxs(ke,{className:"flex items-center gap-3 text-white",children:[e.jsx("div",{className:"flex h-10 w-10 items-center justify-center rounded-full bg-white/20",children:e.jsx(J,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold",children:"Hasil Analisis Status Gizi"}),e.jsx("p",{className:"text-sm opacity-90",children:"Rekomendasi berdasarkan kondisi kesehatan"})]})]})}),e.jsxs("div",{className:"max-h-[70vh] overflow-y-auto p-6",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-6 rounded-xl border border-slate-200 bg-slate-50 p-5",children:[e.jsxs("h3",{className:"flex items-center gap-2 text-lg font-semibold text-slate-800",children:[e.jsx($,{className:"h-5 w-5 text-slate-600"}),"Informasi Pasien"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between border-b border-slate-200 pb-2",children:[e.jsx("span",{className:"text-slate-600",children:"Nama"}),e.jsx("span",{className:"font-medium",children:n.nama||"-"})]}),e.jsxs("div",{className:"flex justify-between border-b border-slate-200 pb-2",children:[e.jsx("span",{className:"text-slate-600",children:"Tanggal Lahir"}),e.jsx("span",{className:"font-medium",children:n.tanggal_lahir||"-"})]}),e.jsxs("div",{className:"flex justify-between border-b border-slate-200 pb-2",children:[e.jsx("span",{className:"text-slate-600",children:"Usia"}),e.jsx("span",{className:"font-medium",children:xe(n.tanggal_lahir)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-600",children:"Tempat Lahir"}),e.jsx("span",{className:"font-medium",children:n.tempat_lahir||"-"})]})]})]}),e.jsxs("div",{className:"space-y-6 rounded-xl border border-slate-200 bg-slate-50 p-5",children:[e.jsxs("h3",{className:"flex items-center gap-2 text-lg font-semibold text-slate-800",children:[e.jsx(Le,{className:"h-5 w-5 text-slate-600"}),"Status Gizi"]}),e.jsxs("div",{className:"flex flex-col items-center justify-center space-y-4 py-2",children:[e.jsx("div",{className:`rounded-full p-1 ${(t==null?void 0:t.label)==="beresiko"?"bg-red-100":(t==null?void 0:t.label)==="gizi buruk"?"bg-yellow-100":(t==null?void 0:t.label)==="gizi normal"?"bg-green-100":"bg-blue-100"}`,children:e.jsx("div",{className:`flex h-24 w-24 items-center justify-center rounded-full ${(t==null?void 0:t.label)==="beresiko"?"bg-red-500":(t==null?void 0:t.label)==="gizi buruk"?"bg-yellow-500":(t==null?void 0:t.label)==="gizi normal"?"bg-green-500":"bg-blue-500"}`,children:(t==null?void 0:t.label)==="gizi normal"?e.jsx(ee,{className:"h-10 w-10 text-white"}):e.jsx(Be,{className:"h-10 w-10 text-white"})})}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm font-medium text-slate-600",children:"Status IMT"}),e.jsx("p",{className:`rounded-2xl p-2 text-xl font-bold ${pe}`,children:(t==null?void 0:t.label)||"-"})]})]})]})]}),e.jsxs("div",{className:"mt-6 rounded-xl border border-slate-200 bg-slate-50 p-5",children:[e.jsxs("h3",{className:"mb-4 flex items-center gap-2 text-lg font-semibold text-slate-800",children:[e.jsx(Te,{className:"h-5 w-5 text-slate-600"}),"Rekomendasi Gizi"]}),e.jsx(Ie,{data:n.statusGizi})]}),e.jsx("div",{className:"mt-6",children:e.jsxs(A,{type:"button",variant:"default",size:"sm",className:"w-full bg-gradient-to-r from-green-600 to-emerald-600 py-3 font-medium text-white shadow-md transition-all hover:from-green-700 hover:to-emerald-700 hover:shadow-lg",disabled:p,onClick:H,children:[p?e.jsx(Z,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(ee,{className:"mr-2 h-4 w-4"}),p?"Menyimpan...":"Simpan Hasil Analisis"]})})]})]})]})]})})};function cs({breadcrumb:n,kriteria:d}){const p=h.useMemo(()=>n?n.map(t=>({title:t.title,href:t.href})):[],[n]),[u,f]=h.useState(null),[N,v]=h.useState({title:"",show:!1,message:"",type:"success"}),{auth:H}=se().props,y=new Date().toISOString().split("T")[0],{data:j,setData:x,post:z,processing:k,errors:P}=je({rme:"",user_id:"",nik:"",nama:"",tempat_lahir:"",tanggal_lahir:"",jenis_kelamin:"",alamat:"",tanggal_pemeriksaan:y,kriteria:d.map(t=>({nilai:null,kriteria_id:t.id.toString(),name:t.nama})),label:"",alasan:"",rekomendasi:[],detail:[],statusGizi:[]}),S=t=>{var C,T;t.preventDefault(),j.label==""?x("label",((C=u==null?void 0:u.label)==null?void 0:C.toString())??""):z(route("pemeriksaan.store",{label:(T=u==null?void 0:u.label)==null?void 0:T.toString()}),{onError:D=>{v({title:"Error",show:!0,message:JSON.stringify(D),type:"error"})},preserveState:!0})};return h.useEffect(()=>{u&&u.label&&x("label",u.label.toString())},[u]),e.jsxs(ze,{breadcrumbs:p,children:[e.jsx(Ne,{title:"Create"}),e.jsx(ae,{open:N.show,onOpenChange:()=>v(t=>({...t,show:!1})),title:N.title,description:N.message,duration:5e3,variant:N.type}),e.jsx("div",{className:"dark:bg-elevation-1 flex h-full flex-1 flex-col gap-4 rounded-xl p-1 lg:p-4",children:e.jsx("div",{className:"relative min-h-[100vh] flex-1 overflow-hidden rounded-xl border border-sidebar-border/70 md:min-h-min dark:border-sidebar-border",children:e.jsx(Fe,{children:e.jsx(Me,{children:d&&e.jsx("div",{className:"mt-6",children:e.jsx(Pe,{submit:S,kriteria:d,setResult:f,data:j,setData:x,processing:k,errors:P})})})})})})]})}export{cs as default};
