import{K as ee,r as c,j as e,b as R,m as fe,L as be}from"./app-FfUhyKxF.js";import{D as je,e as Ne,a as we,c as ye}from"./dialog-CN1z3bbi.js";import{I as _}from"./input-BypNMtY4.js";import{L}from"./label-DgU5ZaCI.js";import{T as ae}from"./use-mobile-navigation-Ds9M2dNZ.js";import{S as ve}from"./algorithm-model-DLV1cX5r.js";import{F as ke}from"./form-loop-kriteria-C0qzIdEA.js";import{I as B}from"./input-error-B1md15rl.js";import{L as V,H as Se,T as Ce}from"./table-label-sayuran-DNw3jUpv.js";import{B as G}from"./button-BoBOppD_.js";import{U as O}from"./user-D2K_Mk5d.js";import{P as J}from"./person-standing-DtNtDJcD.js";import{M as Q}from"./map-pin-pFn4sKMF.js";import{C as W}from"./calendar-CHbNZM5j.js";import{L as X}from"./loader-circle-BWgdIM74.js";import{A as Ie}from"./activity-rwChJyE_.js";import{S as Te}from"./scale-DJtPoKrt.js";import{C as Z}from"./circle-check-big-Xj2fXGlz.js";import{C as _e}from"./circle-alert-HULn9004.js";import{C as Le,a as Be}from"./card-CG4Wk5qv.js";import{U as Pe}from"./user-auth-layout-xwqKatZH.js";import"./index-Cw4nnVHV.js";import"./index-DoDDpxPe.js";import"./proxy-BlWtMGlG.js";import"./select-DyOX0DGK.js";import"./check-DL3zOPPF.js";import"./react-icons.esm-RkVC7dVF.js";import"./chevron-down-abTDHcS7.js";import"./table-D-UO7cUM.js";import"./clipboard-list-05zP1aTc.js";import"./baby-DWSUWU04.js";import"./index-Cl9vrG5T.js";const Me=({data:n,setData:d,processing:x,errors:j,kriteria:h,setResult:P,setFeature:f,submit:y})=>{const{auth:se}=ee().props,[w,b]=c.useState(!1),[v,M]=c.useState(null),[N]=c.useState(new ve),[z,k]=c.useState(!1),[a,S]=c.useState(null),[C,te]=c.useState(!1),$=new Date,[D,le]=c.useState(""),[I,p]=c.useState({title:"",show:!1,message:"",type:"success"}),ie=c.useCallback(l=>{const{value:s}=l.target,t=h.findIndex(i=>i.nama.toLowerCase().includes("umur")),o=ue(s);d(i=>{var r;return{...i,tanggal_lahir:s,kriteria:(r=i.kriteria)==null?void 0:r.map((m,u)=>u===t?{...m,nilai:o.toString()}:m)}})},[n,d]),re=c.useCallback(l=>{const{name:s,value:t}=l.target,[o,i]=s.split("."),r=Number(i);o==="kriteria"?(t===""||/^-?\d*\.?\d*$/.test(t))&&d(m=>{var U,Y,q;const u=(U=m.kriteria)==null?void 0:U.map((g,T)=>T===r?{...g,nilai:t}:g),F=h.findIndex(g=>g.nama.includes("BB")),E=h.findIndex(g=>g.nama.includes("TB")),H=h.findIndex(g=>g.nama.toLowerCase().includes("imt"));if((r===F||r===E)&&H!==-1){const g=Number(r===F?t:((Y=u==null?void 0:u[F])==null?void 0:Y.nilai)??0),T=Number(r===E?t:((q=u==null?void 0:u[E])==null?void 0:q.nilai)??0);if(g>0&&T>0)return{...m,kriteria:u==null?void 0:u.map((K,pe)=>pe===H?{...K,nilai:ge(g,T)}:K)}}return{...m,kriteria:u}}):d(m=>({...m,[s]:t}))},[h,d]),ne=(l,s)=>{l&&s!==void 0&&n&&n.kriteria?d(l==="label"?t=>({...t,[l]:s}):t=>{var o;return{...t,kriteria:(o=t.kriteria)==null?void 0:o.map((i,r)=>r===Number(l)?{...i,nilai:s}:i)}}):console.error("Invalid data: name, value, or kriteria may be undefined")},oe=async l=>{try{const s=await R.get(route("api.get.label-sayuran-by-label",{label:l}));if(s.status!==200)throw new Error("Failed to fetch label sayuran");const t=await s.data;console.log(t),d(o=>({...o,statusGizi:t}))}catch(s){return console.error(s),p({title:"Error",show:!0,message:s.message,type:"error"}),null}};c.useEffect(()=>{(async()=>{b(!0);try{const s=await N.fetchAndProcessData();await N.loadModel(),M(s)}catch(s){p({title:"Error",show:!0,message:`${s.message}, Lakukan training pada halaman decision Tree sebelum masuk Pemeriksaan Gizi Ibu Hamil`,type:"error"}),te(!0)}finally{b(!1)}})()},[]);const me=l=>{const s=R.get(route("api.get.pasien-by-nik",{nik:l}));s&&s.then(t=>{const o=t.data;d(i=>({...i,nama:o.nama,tempat_lahir:o.tempat_lahir,tanggal_lahir:o.tanggal_lahir,jenis_kelamin:o.jenis_kelamin,alamat:o.alamat}))}).catch(t=>{console.log(t)})},ce=async l=>{var s,t;l.preventDefault(),b(!0);try{const o=(s=n.kriteria)==null?void 0:s.map(i=>{const r=i.nilai;(r==null||r==="")&&p({title:"Error",show:!0,message:"Nilai jenis kelamin, usia,  BB, TB, IMT Tidak Boleh Kosong ",type:"error"});const m=String(r).toLowerCase();return m==="laki-laki"?0:m==="perempuan"?1:m==="kurang"?0:m==="sedang"?1:m==="baik"?2:!isNaN(parseFloat(r))&&isFinite(r)?parseFloat(r):r});if(n.nik===""||n.nama===""||n.tempat_lahir==="")console.log(n.nik,n.nama),p({title:"Error",show:!0,message:"NIK, Nama, Orang Tua, Tempat Lahir Tidak Boleh Kosong ",type:"error"});else{const i=await N.predict([o??[]]);if(i.error)p({title:"Hasil Prediksi",show:!0,message:i.error,type:"success"});else if(S(i),f&&f(n.kriteria),i.label!==void 0&&i.label!==null){const r=i.label.toString();d(m=>({...m,label:r})),P(i),oe(((t=i.label)==null?void 0:t.toString())??""),de()}}}catch(o){console.error(o),p({title:"Hasil Prediksi",show:!0,message:o,type:"success"})}finally{b(!1)}};c.useEffect(()=>{a&&a.label&&(console.log("Prediction label changed:",a.label),d("label",a.label.toString()))},[a]);const de=()=>{k(!0)},A=new Date($);A.setFullYear($.getFullYear()-1),A.toISOString().split("T")[0];function he(l){const s=new Date(l),t=new Date;let o=t.getFullYear()-s.getFullYear(),i=t.getMonth()-s.getMonth(),r=t.getDate()-s.getDate();return r<0&&(i--,r+=new Date(t.getFullYear(),t.getMonth(),0).getDate()),i<0&&(o--,i+=12),`${o} tahun, ${i} bulan, ${r} hari`}function ue(l){const s=new Date(l),t=new Date;let o=t.getFullYear()-s.getFullYear(),i=t.getMonth()-s.getMonth(),r=t.getDate()-s.getDate(),m=o*12+i;return r<0&&(m-=1),m.toString()}const xe=c.useMemo(()=>{if(!a)return"";switch(a.label){case"beresiko":return"bg-red-100 border-red-300 text-red-800";case"gizi buruk":return"bg-yellow-100 border-yellow-300 text-yellow-800";case"gizi normal":return"bg-green-100 border-green-300 text-green-800";default:return"bg-blue-100 border-blue-300 text-blue-800"}},[a]),ge=(l,s)=>{const t=s/100;return(l/(t*t)).toFixed(3)};return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-blue-50 px-4 py-8",children:e.jsxs("div",{className:"mx-auto max-w-4xl",children:[e.jsx(ae,{open:I.show,onOpenChange:()=>p(l=>({...l,show:!1})),title:I.title,description:I.message,duration:1e4,variant:I.type}),e.jsxs("div",{className:"mb-8 text-center",children:[e.jsxs("div",{className:"inline-flex items-center gap-3 rounded-full bg-white px-4 py-2 shadow-sm",children:[e.jsx("div",{className:"flex h-10 w-10 items-center justify-center rounded-full bg-green-100",children:e.jsx(V,{className:"h-5 w-5 text-green-600"})}),e.jsx("h1",{className:"text-xl font-bold text-slate-800",children:"Deteksi Status Gizi Ibu Hamil"})]}),e.jsx("p",{className:"mt-3 text-slate-600",children:"Sistem prediksi status gizi menggunakan metode SVM"})]}),e.jsxs("div",{className:"overflow-hidden rounded-2xl border border-slate-200 bg-white shadow-lg",children:[e.jsxs("div",{className:"bg-gradient-to-r from-green-500 to-emerald-600 p-4 text-white",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Data Pasien"}),e.jsx("p",{className:"text-sm opacity-90",children:"Lengkapi informasi di bawah untuk analisis gizi"})]}),e.jsx("div",{className:"p-6 md:p-8",children:e.jsxs("form",{onSubmit:l=>ce(l),className:"space-y-6",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(L,{htmlFor:"nik",className:"flex items-center gap-2",children:[e.jsx(O,{className:"h-4 w-4 text-slate-500"}),"NIK Pasien"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(_,{id:"nik",type:"text",required:!0,tabIndex:1,autoComplete:"nik",value:D,onChange:l=>{const s=l.target.value;/^\d*$/.test(s)&&s.length<=16&&(d(t=>({...t,nik:s})),le(s))},disabled:x,placeholder:"Masukkan NIK Pasien",className:"pl-10"}),e.jsx("div",{className:"absolute inset-y-0 left-0 flex items-center pl-3",children:e.jsx(O,{className:"h-4 w-4 text-slate-400"})})]}),e.jsx(G,{type:"button",variant:"outline",onClick:()=>{D.length<=16?me(Number(D)):p({title:"Error",show:!0,message:"NIK harus 16 digit",type:"error"})},children:"Cari"})]}),e.jsx(B,{message:j.nik,className:"mt-2"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(L,{htmlFor:"nama",className:"flex items-center gap-2",children:[e.jsx(J,{className:"h-4 w-4 text-slate-500"}),"Nama Pasien"]}),e.jsxs("div",{className:"relative",children:[e.jsx(_,{id:"nama",type:"text",required:!0,tabIndex:1,autoComplete:"nama",value:n.nama,onChange:l=>d({...n,nama:l.target.value}),disabled:x,placeholder:"Nama Lengkap Pasien",className:"pl-10"}),e.jsx("div",{className:"absolute inset-y-0 left-0 flex items-center pl-3",children:e.jsx(J,{className:"h-4 w-4 text-slate-400"})})]}),e.jsx(B,{message:j.nama,className:"mt-2"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(L,{htmlFor:"tempat_lahir",className:"flex items-center gap-2",children:[e.jsx(Q,{className:"h-4 w-4 text-slate-500"}),"Tempat Lahir"]}),e.jsxs("div",{className:"relative",children:[e.jsx(_,{id:"tempat_lahir",type:"text",required:!0,tabIndex:2,autoComplete:"tempat_lahir",value:n.tempat_lahir,onChange:l=>d({...n,tempat_lahir:l.target.value}),disabled:x,placeholder:"Kota tempat lahir",className:"pl-10"}),e.jsx("div",{className:"absolute inset-y-0 left-0 flex items-center pl-3",children:e.jsx(Q,{className:"h-4 w-4 text-slate-400"})})]}),e.jsx(B,{message:j.tempat_lahir})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(L,{htmlFor:"tanggal_lahir",className:"flex items-center gap-2",children:[e.jsx(W,{className:"h-4 w-4 text-slate-500"}),"Tanggal Lahir"]}),e.jsxs("div",{className:"relative",children:[e.jsx(_,{id:"tanggal_lahir",type:"date",required:!0,tabIndex:2,autoComplete:"tanggal_lahir",value:n.tanggal_lahir,onChange:l=>ie(l),disabled:x,className:"pl-10"}),e.jsx("div",{className:"absolute inset-y-0 left-0 flex items-center pl-3",children:e.jsx(W,{className:"h-4 w-4 text-slate-400"})})]}),e.jsx(B,{message:j.tanggal_lahir})]})]})]}),e.jsx(ke,{kriteria:h,data:n,setData:d,handleChange:re,handleSelectChange:ne,processing:x}),e.jsx("div",{className:"pt-4",children:e.jsxs(G,{type:"submit",disabled:w||!N||C,className:"w-full bg-gradient-to-r from-green-600 to-emerald-600 py-3 font-medium text-white shadow-md transition-all hover:from-green-700 hover:to-emerald-700 hover:shadow-lg disabled:opacity-50",children:[w?e.jsx(X,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(Ie,{className:"mr-2 h-4 w-4"}),w?"Memproses...":"Analisis Status Gizi"]})})]})})]}),e.jsxs(je,{open:z,onOpenChange:k,children:[e.jsx(Ne,{}),e.jsxs(we,{className:"max-w-4xl overflow-hidden rounded-2xl p-0",children:[e.jsx("div",{className:"bg-gradient-to-r from-green-500 to-emerald-600 p-6 text-white",children:e.jsxs(ye,{className:"flex items-center gap-3 text-white",children:[e.jsx("div",{className:"flex h-10 w-10 items-center justify-center rounded-full bg-white/20",children:e.jsx(V,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold",children:"Hasil Analisis Status Gizi"}),e.jsx("p",{className:"text-sm opacity-90",children:"Rekomendasi berdasarkan kondisi kesehatan"})]})]})}),e.jsxs("div",{className:"max-h-[70vh] overflow-y-auto p-6",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-6 rounded-xl border border-slate-200 bg-slate-50 p-5",children:[e.jsxs("h3",{className:"flex items-center gap-2 text-lg font-semibold text-slate-800",children:[e.jsx(O,{className:"h-5 w-5 text-slate-600"}),"Informasi Pasien"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between border-b border-slate-200 pb-2",children:[e.jsx("span",{className:"text-slate-600",children:"Nama"}),e.jsx("span",{className:"font-medium",children:n.nama||"-"})]}),e.jsxs("div",{className:"flex justify-between border-b border-slate-200 pb-2",children:[e.jsx("span",{className:"text-slate-600",children:"Tanggal Lahir"}),e.jsx("span",{className:"font-medium",children:n.tanggal_lahir||"-"})]}),e.jsxs("div",{className:"flex justify-between border-b border-slate-200 pb-2",children:[e.jsx("span",{className:"text-slate-600",children:"Usia"}),e.jsx("span",{className:"font-medium",children:he(n.tanggal_lahir)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-600",children:"Tempat Lahir"}),e.jsx("span",{className:"font-medium",children:n.tempat_lahir||"-"})]})]})]}),e.jsxs("div",{className:"space-y-6 rounded-xl border border-slate-200 bg-slate-50 p-5",children:[e.jsxs("h3",{className:"flex items-center gap-2 text-lg font-semibold text-slate-800",children:[e.jsx(Te,{className:"h-5 w-5 text-slate-600"}),"Status Gizi"]}),e.jsxs("div",{className:"flex flex-col items-center justify-center space-y-4 py-2",children:[e.jsx("div",{className:`rounded-full p-1 ${(a==null?void 0:a.label)==="beresiko"?"bg-red-100":(a==null?void 0:a.label)==="gizi buruk"?"bg-yellow-100":(a==null?void 0:a.label)==="gizi normal"?"bg-green-100":"bg-blue-100"}`,children:e.jsx("div",{className:`flex h-24 w-24 items-center justify-center rounded-full ${(a==null?void 0:a.label)==="beresiko"?"bg-red-500":(a==null?void 0:a.label)==="gizi buruk"?"bg-yellow-500":(a==null?void 0:a.label)==="gizi normal"?"bg-green-500":"bg-blue-500"}`,children:(a==null?void 0:a.label)==="gizi normal"?e.jsx(Z,{className:"h-10 w-10 text-white"}):e.jsx(_e,{className:"h-10 w-10 text-white"})})}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm font-medium text-slate-600",children:"Status IMT"}),e.jsx("p",{className:`rounded-2xl p-2 text-xl font-bold ${xe}`,children:(a==null?void 0:a.label)||"-"})]})]})]})]}),e.jsxs("div",{className:"mt-6 rounded-xl border border-slate-200 bg-slate-50 p-5",children:[e.jsxs("h3",{className:"mb-4 flex items-center gap-2 text-lg font-semibold text-slate-800",children:[e.jsx(Se,{className:"h-5 w-5 text-slate-600"}),"Rekomendasi Gizi"]}),e.jsx(Ce,{data:n.statusGizi})]}),e.jsx("div",{className:"mt-6",children:e.jsxs(G,{type:"button",variant:"default",size:"sm",className:"w-full bg-gradient-to-r from-green-600 to-emerald-600 py-3 font-medium text-white shadow-md transition-all hover:from-green-700 hover:to-emerald-700 hover:shadow-lg",disabled:x,onClick:y,children:[x?e.jsx(X,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(Z,{className:"mr-2 h-4 w-4"}),x?"Menyimpan...":"Simpan Hasil Analisis"]})})]})]})]})]})})};function ha({breadcrumb:n,pasien:d,kriteria:x}){const{auth:j}=ee().props;c.useMemo(()=>n?n.map(a=>({title:a.title,href:a.href})):[],[n]);const[h,P]=c.useState(null),[f,y]=c.useState({title:"",show:!1,message:"",type:"success"}),w=new Date().toISOString().split("T")[0],{data:b,setData:v,post:M,processing:N,errors:z}=fe({rme:"",nik:"",user_id:j.user.id.toString(),nama:"",tempat_lahir:"",tanggal_lahir:"",jenis_kelamin:"",alamat:"",tanggal_pemeriksaan:w,kriteria:x.map(a=>({nilai:null,kriteria_id:a.id.toString(),name:a.nama})),label:"",alasan:"",rekomendasi:[],usia_pasien:"",detail:[],statusGizi:[]}),k=a=>{var S;a.preventDefault(),b.label==""?v("label",((S=h==null?void 0:h.label)==null?void 0:S.toString())??""):M(route("pemeriksaan.store"),{onError:C=>{console.log(C),y({title:"Error",show:!0,message:JSON.stringify(C),type:"error"})},preserveState:!0})};return c.useEffect(()=>{h&&h.label&&v("label",h.label.toString())},[h]),e.jsxs(Pe,{children:[e.jsx(be,{title:"Create"}),e.jsx(ae,{open:f.show,onOpenChange:()=>y(a=>({...a,show:!1})),title:f.title,description:f.message,duration:5e3,variant:f.type}),e.jsx(Le,{className:"border-none shadow-none",children:e.jsx(Be,{className:"p-6",children:e.jsx("div",{className:"grid gap-8",children:e.jsx(Me,{submit:k,kriteria:x,setResult:P,data:b,setData:v,processing:N,errors:z})})})})]})}export{ha as default};
